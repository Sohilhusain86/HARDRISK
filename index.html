<!DOCTYPE html>
<html lang="ur">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zikr-o-Nazar ‚Ä¢ Digital Islamic Library</title>

<style>
/* =========================
   ROOT & THEME SYSTEM
========================= */
:root{
  --bg:#0f1115;
  --panel:#161922;
  --card:#1f2330;
  --text:#e9ecf1;
  --muted:#9aa3b2;
  --accent:#4dd0e1;
  --danger:#ff6b6b;
  --radius:14px;
  --shadow:0 20px 40px rgba(0,0,0,.35);
}
[data-theme="light"]{
  --bg:#f5f7fb;
  --panel:#ffffff;
  --card:#f0f2f7;
  --text:#1b1e28;
  --muted:#5b6475;
  --accent:#0066ff;
  --shadow:0 20px 40px rgba(0,0,0,.12);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
}

/* =========================
   LAYOUT
========================= */
header{
  position:sticky;
  top:0;
  z-index:50;
  background:linear-gradient(180deg,var(--panel),transparent);
  backdrop-filter:blur(10px);
}
.topbar{
  display:flex;
  gap:12px;
  align-items:center;
  padding:14px 16px;
}
.logo{
  font-weight:800;
  letter-spacing:.5px;
}
.logo span{color:var(--accent)}
.search{
  flex:1;
  position:relative;
}
.search input{
  width:100%;
  padding:12px 40px 12px 14px;
  border-radius:999px;
  border:none;
  outline:none;
  background:var(--card);
  color:var(--text);
}
.search svg{
  position:absolute;
  right:14px;
  top:50%;
  transform:translateY(-50%);
  opacity:.6;
}
.actions button{
  background:var(--card);
  border:none;
  color:var(--text);
  padding:10px 14px;
  border-radius:999px;
  cursor:pointer;
}
.actions button:hover{opacity:.8}

/* =========================
   TABS
========================= */
.tabs{
  display:flex;
  gap:8px;
  padding:0 16px 12px;
}
.tabs button{
  flex:1;
  padding:10px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  background:var(--card);
  color:var(--muted);
}
.tabs button.active{
  background:var(--accent);
  color:#000;
  font-weight:700;
}

/* =========================
   CONTENT
========================= */
main{padding:16px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:14px;
}
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:12px;
  box-shadow:var(--shadow);
  cursor:pointer;
  transition:.25s;
}
.card:hover{transform:translateY(-4px)}
.card .icon{
  font-size:36px;
  opacity:.8;
}
.card .title{
  margin-top:8px;
  font-size:14px;
  font-weight:600;
}
.card .meta{
  font-size:12px;
  color:var(--muted);
}

/* =========================
   PLAYER
========================= */
.player{
  position:fixed;
  left:0;right:0;bottom:0;
  background:var(--panel);
  padding:10px 14px;
  display:none;
  gap:10px;
  align-items:center;
}
.player.active{display:flex}
.player button{
  background:none;
  border:none;
  color:var(--text);
  font-size:20px;
  cursor:pointer;
}
.player .info{
  flex:1;
  overflow:hidden;
}
.player .info div{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.player input[type=range]{width:100%}

/* =========================
   MODAL
========================= */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.modal.active{display:flex}
.modal .box{
  width:92%;
  height:92%;
  background:var(--panel);
  border-radius:var(--radius);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.modal header{
  padding:10px;
  display:flex;
  justify-content:space-between;
}
.modal iframe{
  flex:1;
  width:100%;
  border:none;
}

/* =========================
   FOOTER
========================= */
footer{
  text-align:center;
  padding:40px 16px 90px;
  font-size:12px;
  color:var(--muted);
}
</style>
</head>

<body>

<header>
  <div class="topbar">
    <div class="logo">Zikr-o-<span>Nazar</span></div>
    <div class="search">
      <input id="search" placeholder="Search Naat, Bayan, Book‚Ä¶">
      <svg width="18" height="18"><circle cx="8" cy="8" r="7" stroke="currentColor" fill="none"/></svg>
    </div>
    <div class="actions">
      <button id="themeBtn">üåì</button>
    </div>
  </div>
  <div class="tabs">
    <button class="active" data-tab="audio">Audio</button>
    <button data-tab="pdf">Books</button>
  </div>
</header>

<main>
  <div id="audio" class="grid"></div>
  <div id="pdf" class="grid" style="display:none"></div>
</main>

<footer>
  Digital Islamic Library ‚Ä¢ Non-commercial ‚Ä¢ Educational purpose only
</footer>

<!-- PLAYER -->
<div class="player" id="player">
  <button id="prev">‚èÆ</button>
  <button id="play">‚ñ∂Ô∏è</button>
  <button id="next">‚è≠</button>
  <div class="info">
    <div id="nowTitle"></div>
    <input type="range" id="seek" min="0" max="100" value="0">
  </div>
</div>

<!-- PDF MODAL -->
<div class="modal" id="pdfModal">
  <div class="box">
    <header>
      <div id="pdfTitle"></div>
      <button onclick="closePDF()">‚úñ</button>
    </header>
    <iframe id="pdfFrame"></iframe>
  </div>
</div>

<audio id="audioEl"></audio>

<script>
/* =========================
   STATE
========================= */
const state={
  tab:'audio',
  list:[],
  index:0
};
const repo={
  owner:'YOUR_GITHUB_USERNAME',
  name:'YOUR_REPO_NAME',
  branch:'main'
};

/* =========================
   THEME
========================= */
const themeBtn=document.getElementById('themeBtn');
const savedTheme=localStorage.getItem('theme');
if(savedTheme)document.documentElement.dataset.theme=savedTheme;
themeBtn.onclick=()=>{
  const t=document.documentElement.dataset.theme==='light'?'':'light';
  document.documentElement.dataset.theme=t;
  localStorage.setItem('theme',t);
};

/* =========================
   TABS
========================= */
document.querySelectorAll('.tabs button').forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll('.tabs button').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    state.tab=b.dataset.tab;
    document.getElementById('audio').style.display=state.tab==='audio'?'grid':'none';
    document.getElementById('pdf').style.display=state.tab==='pdf'?'grid':'none';
  };
});

/* =========================
   FETCH FILES
========================= */
async function loadFiles(){
  const url=`https://api.github.com/repos/${repo.owner}/${repo.name}/contents`;
  const res=await fetch(url);
  const data=await res.json();
  const audio=data.filter(f=>f.name.match(/\.(mp3|wav)$/i));
  const pdf=data.filter(f=>f.name.match(/\.pdf$/i));
  render(audio,'audio');
  render(pdf,'pdf');
}
function render(files,type){
  const box=document.getElementById(type);
  box.innerHTML='';
  files.forEach((f,i)=>{
    const d=document.createElement('div');
    d.className='card';
    d.innerHTML=`
      <div class="icon">${type==='audio'?'üéß':'üìò'}</div>
      <div class="title">${f.name}</div>
      <div class="meta">${type.toUpperCase()}</div>`;
    d.onclick=()=> type==='audio'?play(i,files):openPDF(f);
    box.appendChild(d);
  });
}

/* =========================
   AUDIO
========================= */
const audioEl=document.getElementById('audioEl');
const player=document.getElementById('player');
const playBtn=document.getElementById('play');
const seek=document.getElementById('seek');
function play(i,list){
  state.list=list;
  state.index=i;
  audioEl.src=list[i].download_url;
  audioEl.play();
  player.classList.add('active');
  document.getElementById('nowTitle').textContent=list[i].name;
  playBtn.textContent='‚è∏';
}
playBtn.onclick=()=>{
  if(audioEl.paused){audioEl.play();playBtn.textContent='‚è∏'}
  else{audioEl.pause();playBtn.textContent='‚ñ∂Ô∏è'}
};
audioEl.ontimeupdate=()=>{
  seek.value=(audioEl.currentTime/audioEl.duration||0)*100;
};
seek.oninput=()=>{
  audioEl.currentTime=(seek.value/100)*audioEl.duration;
};
document.getElementById('next').onclick=()=>{
  if(state.index<state.list.length-1)play(state.index+1,state.list);
};
document.getElementById('prev').onclick=()=>{
  if(state.index>0)play(state.index-1,state.list);
};

/* =========================
   PDF
========================= */
function openPDF(f){
  pdfModal.classList.add('active');
  pdfFrame.src=f.download_url;
  pdfTitle.textContent=f.name;
}
function closePDF(){
  pdfModal.classList.remove('active');
  pdfFrame.src='';
}

/* =========================
   SEARCH
========================= */
document.getElementById('search').oninput=e=>{
  const q=e.target.value.toLowerCase();
  document.querySelectorAll('.card').forEach(c=>{
    c.style.display=c.innerText.toLowerCase().includes(q)?'':'none';
  });
};

loadFiles();
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Zikr-o-Nazar | Offline Islamic Library</title>

<meta name="description" content="Zikr-o-Nazar ‚Äì Professional Islamic Digital Library with Offline Audio & Books">
<meta name="theme-color" content="#064e3b">

<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;Zikr-o-Nazar&quot;,
  &quot;short_name&quot;:&quot;Zikr&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#020617&quot;,
  &quot;theme_color&quot;:&quot;#064e3b&quot;,
  &quot;icons&quot;:[{
    &quot;src&quot;:&quot;https://cdn-icons-png.flaticon.com/512/4205/4205906.png&quot;,
    &quot;sizes&quot;:&quot;512x512&quot;,
    &quot;type&quot;:&quot;image/png&quot;
  }]
}">

<link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
--primary:#064e3b;
--bg:#020617;
--surface:#0f172a;
--text:#f1f5f9;
--muted:#94a3b8;
--border:rgba(255,255,255,.08);
--radius:18px;
}
*{box-sizing:border-box}
body{
margin:0;
font-family:'Plus Jakarta Sans',sans-serif;
background:var(--bg);
color:var(--text);
min-height:100vh;
}
.urdu{font-family:'Noto Nastaliq Urdu';line-height:2.3}
header{
position:sticky;top:0;z-index:100;
background:rgba(15,23,42,.9);
backdrop-filter:blur(14px);
border-bottom:1px solid var(--border);
}
nav{
max-width:1300px;
margin:auto;
padding:1rem;
display:flex;
justify-content:space-between;
align-items:center;
}
.brand{
display:flex;gap:10px;
align-items:center;
font-weight:800;
font-size:1.4rem;
color:#10b981;
}
main{max-width:1300px;margin:auto;padding:1.5rem}
.search{
background:var(--surface);
border:1px solid var(--border);
border-radius:999px;
padding:.7rem 1.2rem;
display:flex;
gap:10px;
align-items:center;
}
.search input{
flex:1;
background:none;
border:none;
outline:none;
color:var(--text);
font-size:1rem;
}
.grid{
margin-top:1.5rem;
display:grid;
grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
gap:1.2rem;
}
.card{
background:var(--surface);
border:1px solid var(--border);
border-radius:var(--radius);
padding:1.4rem;
display:flex;
flex-direction:column;
gap:.8rem;
transition:.3s;
}
.card:hover{transform:translateY(-5px);border-color:#10b981}
.tag{
font-size:.7rem;
font-weight:800;
padding:4px 10px;
border-radius:6px;
width:max-content;
}
.audio{background:#064e3b;color:#ecfdf5}
.book{background:#075985;color:#e0f2fe}
button,a.btn{
padding:.7rem;
border-radius:12px;
border:none;
cursor:pointer;
font-weight:700;
}
.play{background:#10b981;color:#022c22}
.down{background:#020617;border:1px solid var(--border);color:var(--text)}
.player{
position:fixed;
bottom:0;left:0;right:0;
background:var(--surface);
border-top:1px solid var(--border);
padding:1rem;
transform:translateY(120%);
transition:.4s;
}
.player.active{transform:translateY(0)}
.progress{height:6px;background:#020617;border-radius:10px;overflow:hidden}
.bar{height:100%;width:0;background:#10b981}
.install{
position:fixed;
bottom:90px;
right:20px;
background:#10b981;
color:#022c22;
padding:.8rem 1.1rem;
border-radius:999px;
font-weight:800;
display:none;
z-index:999;
}
.offline{
position:fixed;
top:0;left:0;right:0;
background:#7c2d12;
color:#fff;
text-align:center;
padding:.5rem;
display:none;
z-index:200;
}
</style>
</head>

<body>

<div class="offline" id="offlineBar">ÿ¢Ÿæ ÿßÿ≥ ŸàŸÇÿ™ ÿ¢ŸÅ ŸÑÿßÿ¶ŸÜ €Å€å⁄∫</div>

<header>
<nav>
<div class="brand">üïå <span class="urdu">ÿ∞⁄©ÿ± Ÿà ŸÜÿ∏ÿ±</span></div>
<span id="count" style="font-size:.8rem;color:var(--muted)">Indexing‚Ä¶</span>
</nav>
</header>

<main>
<div class="search">
üîç <input id="q" placeholder="ŸÜÿπÿ™ €åÿß ⁄©ÿ™ÿßÿ® ÿ™ŸÑÿßÿ¥ ⁄©ÿ±€å⁄∫‚Ä¶">
</div>
<div class="grid" id="grid"></div>
</main>

<div class="player" id="player">
<div class="urdu" id="ptitle">‚Äî</div>
<div style="font-size:.8rem;color:var(--muted)" id="partist">‚Äî</div>
<div class="progress" id="seek"><div class="bar" id="bar"></div></div>
<div style="margin-top:.6rem;text-align:center">
<button id="toggle">‚ñ∂</button>
</div>
</div>

<button class="install" id="installBtn">üì≤ Install App</button>

<audio id="audio"></audio>

<script>
/* ================= CONFIG ================= */
const REPO={
owner:'Sohilhusain86',
name:'HARDRISK',
branch:'main'
};
const API=`https://api.github.com/repos/${REPO.owner}/${REPO.name}/contents/`;
const RAW=`https://github.com/${REPO.owner}/${REPO.name}/raw/${REPO.branch}/`;

/* ================= STATE ================= */
const state={
list:[],
playlist:[],
index:-1,
deferred:null
};

/* ================= DOM ================= */
const grid=document.getElementById('grid');
const q=document.getElementById('q');
const audio=document.getElementById('audio');
const player=document.getElementById('player');
const bar=document.getElementById('bar');

/* ================= INIT ================= */
init();
async function init(){
await loadFiles();
bind();
registerSW();
}

/* ================= LOAD ================= */
async function loadFiles(){
const r=await fetch(API);
const f=await r.json();
state.list=f.filter(x=>x.name.endsWith('.mp3')||x.name.endsWith('.pdf'))
.map(x=>{
const isAudio=x.name.endsWith('.mp3');
return{
id:btoa(x.name),
title:decodeURIComponent(x.name).replace(/\.(mp3|pdf)/,''),
artist:'Zikr-o-Nazar',
type:isAudio?'audio':'book',
url:RAW+x.name
};
});
document.getElementById('count').innerText=
`${state.list.filter(x=>x.type==='audio').length} Naats | ${state.list.filter(x=>x.type==='book').length} Books`;
render();
}

/* ================= RENDER ================= */
function render(v=''){
grid.innerHTML='';
state.list.filter(i=>i.title.toLowerCase().includes(v.toLowerCase()))
.forEach(i=>{
const d=document.createElement('div');
d.className='card';
d.innerHTML=`
<div class="tag ${i.type}">${i.type==='audio'?'Naat':'Book'}</div>
<div class="urdu">${i.title}</div>
<div style="display:flex;gap:10px;margin-top:auto">
<button class="play" onclick="openItem('${i.id}')">${i.type==='audio'?'‚ñ∂ ÿ≥ŸÜ€å⁄∫':'üìñ Ÿæ⁄ë⁄æ€å⁄∫'}</button>
<a class="btn down" href="${i.url}" download>üì•</a>
</div>`;
grid.appendChild(d);
});
}

/* ================= ACTION ================= */
function openItem(id){
const item=state.list.find(x=>x.id===id);
if(item.type==='audio'){
state.playlist=state.list.filter(x=>x.type==='audio');
state.index=state.playlist.findIndex(x=>x.id===id);
play(item);
}else{
window.open(item.url,'_blank');
}
}

function play(i){
audio.src=i.url;
audio.play();
player.classList.add('active');
document.getElementById('ptitle').innerText=i.title;
document.getElementById('partist').innerText=i.artist;
document.getElementById('toggle').innerText='‚è∏';
}

document.getElementById('toggle').onclick=()=>{
if(audio.paused){audio.play();toggle.innerText='‚è∏'}
else{audio.pause();toggle.innerText='‚ñ∂'}
};

audio.ontimeupdate=()=>{
bar.style.width=(audio.currentTime/audio.duration*100)+'%';
};

/* ================= SEARCH ================= */
q.oninput=e=>render(e.target.value);

/* ================= OFFLINE ================= */
window.addEventListener('online',()=>offlineBar.style.display='none');
window.addEventListener('offline',()=>offlineBar.style.display='block');

/* ================= INSTALL ================= */
window.addEventListener('beforeinstallprompt',e=>{
e.preventDefault();
state.deferred=e;
installBtn.style.display='block';
});
installBtn.onclick=()=>{
state.deferred.prompt();
installBtn.style.display='none';
};

/* ================= SERVICE WORKER ================= */
function registerSW(){
if(!('serviceWorker'in navigator))return;
const sw=`
const CACHE='zikr-cache-v2';
self.addEventListener('install',e=>{
e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])));
});
self.addEventListener('fetch',e=>{
e.respondWith(
caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{
const copy=res.clone();
caches.open(CACHE).then(c=>c.put(e.request,copy));
return res;
}).catch(()=>r))
);
});
`;
const blob=new Blob([sw],{type:'text/javascript'});
navigator.serviceWorker.register(URL.createObjectURL(blob));
}
</script>
</body>
</html>
<!-- =========================
PART 3 ‚Äì CORE LOGIC, AUDIO, SEARCH, PDF, OFFLINE
PROJECT: Zikr-o-Nazar
========================= -->

<script>
/* =========================
CENTRAL CONFIG
========================= */
const CONFIG = {
  version: "1.0.0",
  storageKey: "zikr_o_nazar_prefs",
  audioKey: "zikr_o_nazar_audio",
  cacheName: "zikr-o-nazar-cache-v1",
  maxDownloadPerMinute: 3
};

/* =========================
SAFE STORAGE
========================= */
const SafeStorage = (() => {
  let memory = {};
  function isAvailable() {
    try {
      const t = "__t";
      localStorage.setItem(t, t);
      localStorage.removeItem(t);
      return true;
    } catch {
      return false;
    }
  }
  const ok = isAvailable();
  return {
    get(k, d = null) {
      try {
        return ok ? JSON.parse(localStorage.getItem(k)) ?? d : memory[k] ?? d;
      } catch {
        return d;
      }
    },
    set(k, v) {
      try {
        ok ? localStorage.setItem(k, JSON.stringify(v)) : (memory[k] = v);
      } catch {}
    }
  };
})();

/* =========================
THEME & PREFERENCES
========================= */
const Preferences = (() => {
  const defaults = {
    theme: "system",
    fontScale: 1,
    reducedMotion: false,
    volume: 0.8
  };
  let state = { ...defaults, ...SafeStorage.get(CONFIG.storageKey, {}) };

  function apply() {
    const root = document.documentElement;
    let theme = state.theme;
    if (theme === "system") {
      theme = matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    root.dataset.theme = theme;
    root.style.fontSize = `${state.fontScale * 100}%`;
    root.dataset.motion = state.reducedMotion ? "reduced" : "normal";
  }

  function save() {
    SafeStorage.set(CONFIG.storageKey, state);
  }

  apply();

  return {
    get: () => state,
    set(k, v) {
      state[k] = v;
      apply();
      save();
    }
  };
})();

/* =========================
DATE & HIJRI ENGINE
========================= */
const DateEngine = (() => {
  function hijriFromGregorian(date) {
    const jd = Math.floor((date / 86400000) + 2440587.5);
    const l = jd - 1948440 + 10632;
    const n = Math.floor((l - 1) / 10631);
    const r = l - 10631 * n + 354;
    const j = (Math.floor((10985 - r) / 5316)) *
              (Math.floor((50 * r) / 17719)) +
              (Math.floor(r / 5670)) *
              (Math.floor((43 * r) / 15238));
    const r2 = r - (Math.floor((30 - j) / 15)) *
               (Math.floor((17719 * j) / 50)) -
               (Math.floor(j / 16)) *
               (Math.floor((15238 * j) / 43)) + 29;
    const m = Math.floor((24 * r2) / 709);
    const d = r2 - Math.floor((709 * m) / 24);
    const y = 30 * n + j - 30;
    return { d, m, y };
  }

  function format() {
    const now = new Date();
    const hijri = hijriFromGregorian(now.getTime());
    return {
      gregorian: now.toLocaleDateString("en-IN", { day: "numeric", month: "long", year: "numeric" }),
      hijri: `${hijri.d} / ${hijri.m} / ${hijri.y} AH`
    };
  }

  return { format };
})();

/* =========================
AUDIO ENTERPRISE ENGINE
========================= */
const AudioEngine = (() => {
  let audio = new Audio();
  audio.preload = "metadata";
  audio.volume = Preferences.get().volume;

  let state = SafeStorage.get(CONFIG.audioKey, {
    src: null,
    time: 0,
    playing: false
  });

  function load(src) {
    if (audio.src !== src) {
      audio.src = src;
      audio.currentTime = 0;
    }
  }

  function play(src) {
    load(src);
    audio.play().catch(() => {});
    state.src = src;
    state.playing = true;
    persist();
  }

  function pause() {
    audio.pause();
    state.playing = false;
    persist();
  }

  function stop() {
    audio.pause();
    audio.currentTime = 0;
    state.playing = false;
    persist();
  }

  function persist() {
    state.time = audio.currentTime;
    SafeStorage.set(CONFIG.audioKey, state);
  }

  audio.addEventListener("timeupdate", persist);
  audio.addEventListener("volumechange", () => {
    Preferences.set("volume", audio.volume);
  });

  document.addEventListener("visibilitychange", () => {
    if (document.hidden) persist();
  });

  return { play, pause, stop, audio };
})();

/* =========================
CONTENT DATA (AUDIO + BOOKS)
========================= */
const ContentStore = {
  audio: [
    { id: 1, title: "Naat-e-Rasool Ô∑∫", src: "audio/naat1.mp3", category: "Naat", views: 0 },
    { id: 2, title: "Salam Ya Nabi Ô∑∫", src: "audio/naat2.mp3", category: "Naat", views: 0 }
  ],
  books: [
    { id: 1, title: "Seerat-un-Nabi Ô∑∫", file: "books/seerat.pdf", views: 0 }
  ]
};

/* =========================
SEARCH & FILTER ENGINE
========================= */
const SearchEngine = (() => {
  function search(q) {
    q = q.trim().toLowerCase();
    if (!q) return ContentStore;
    return {
      audio: ContentStore.audio.filter(a => a.title.toLowerCase().includes(q)),
      books: ContentStore.books.filter(b => b.title.toLowerCase().includes(q))
    };
  }
  return { search };
})();

/* =========================
PDF VIEWER ENGINE
========================= */
const PDFEngine = (() => {
  let currentURL = null;
  function open(file) {
    close();
    currentURL = file;
    const iframe = document.createElement("iframe");
    iframe.src = file;
    iframe.setAttribute("aria-label", "PDF Viewer");
    iframe.style.width = "100%";
    iframe.style.height = "100%";
    document.getElementById("pdf-modal-body").appendChild(iframe);
    document.getElementById("pdf-modal").hidden = false;
  }
  function close() {
    const body = document.getElementById("pdf-modal-body");
    body.innerHTML = "";
    document.getElementById("pdf-modal").hidden = true;
    currentURL = null;
  }
  return { open, close };
})();

/* =========================
OFFLINE SERVICE WORKER
========================= */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("sw.js").catch(() => {});
  });
}

/* =========================
INIT
========================= */
document.addEventListener("DOMContentLoaded", () => {
  const dates = DateEngine.format();
  const g = document.getElementById("gregorian-date");
  const h = document.getElementById("hijri-date");
  if (g) g.textContent = dates.gregorian;
  if (h) h.textContent = dates.hijri;
});
</script>

<!-- =========================
PART 3 END
NEXT PART = UI RENDERING + SERVICE WORKER INLINE
========================= -->
</html>
<!-- =========================
PART 4 ‚Äì MEGA FEATURES LAYER
UI RENDERING ‚Ä¢ SEARCH ‚Ä¢ INTERACTIONS ‚Ä¢ OFFLINE ‚Ä¢ SECURITY
PROJECT: Zikr-o-Nazar
========================= -->

<script>
/* =========================
DOM HELPERS (SAFE)
========================= */
const DOM = {
  qs: (s, r = document) => r.querySelector(s),
  qsa: (s, r = document) => Array.from(r.querySelectorAll(s)),
  el(tag, attrs = {}, text) {
    const e = document.createElement(tag);
    for (const k in attrs) e.setAttribute(k, attrs[k]);
    if (text) e.textContent = text;
    return e;
  },
  clear(n) {
    while (n.firstChild) n.removeChild(n.firstChild);
  }
};

/* =========================
SCROLL SYSTEM
========================= */
(() => {
  const bar = DOM.qs("#scroll-progress");
  if (!bar) return;
  const onScroll = () => {
    const h = document.documentElement;
    const scrolled = (h.scrollTop / (h.scrollHeight - h.clientHeight)) * 100;
    bar.style.width = scrolled + "%";
  };
  window.addEventListener("scroll", onScroll, { passive: true });
})();

/* =========================
HEADER AUTO-HIDE
========================= */
(() => {
  const header = DOM.qs("header");
  if (!header) return;
  let last = 0;
  window.addEventListener("scroll", () => {
    const y = window.scrollY;
    header.classList.toggle("hide", y > last && y > 80);
    last = y;
  }, { passive: true });
})();

/* =========================
AUDIO UI RENDER
========================= */
function renderAudio(list) {
  const wrap = DOM.qs("#audio-list");
  if (!wrap) return;
  DOM.clear(wrap);
  list.forEach(item => {
    const card = DOM.el("div", { class: "card audio-card", tabindex: "0" });
    const title = DOM.el("h3", {}, item.title);
    const play = DOM.el("button", { class: "btn play" }, "‚ñ∂");
    const stop = DOM.el("button", { class: "btn stop" }, "‚ñ†");

    play.addEventListener("click", () => AudioEngine.play(item.src));
    stop.addEventListener("click", () => AudioEngine.stop());

    card.append(title, play, stop);
    wrap.appendChild(card);
  });
}

/* =========================
BOOK UI RENDER
========================= */
function renderBooks(list) {
  const wrap = DOM.qs("#book-list");
  if (!wrap) return;
  DOM.clear(wrap);
  list.forEach(item => {
    const card = DOM.el("div", { class: "card book-card", tabindex: "0" });
    const title = DOM.el("h3", {}, item.title);
    const open = DOM.el("button", { class: "btn open" }, "Open");

    open.addEventListener("click", () => PDFEngine.open(item.file));

    card.append(title, open);
    wrap.appendChild(card);
  });
}

/* =========================
SEARCH UI BINDING
========================= */
(() => {
  const input = DOM.qs("#search");
  if (!input) return;
  let t;
  input.addEventListener("input", e => {
    clearTimeout(t);
    t = setTimeout(() => {
      const res = SearchEngine.search(e.target.value);
      renderAudio(res.audio);
      renderBooks(res.books);
    }, 200);
  });
})();

/* =========================
THEME TOGGLE
========================= */
(() => {
  const btn = DOM.qs("#theme-toggle");
  if (!btn) return;
  btn.addEventListener("click", () => {
    const cur = Preferences.get().theme;
    Preferences.set("theme", cur === "dark" ? "light" : "dark");
  });
})();

/* =========================
REDUCED MOTION TOGGLE
========================= */
(() => {
  const btn = DOM.qs("#motion-toggle");
  if (!btn) return;
  btn.addEventListener("click", () => {
    Preferences.set("reducedMotion", !Preferences.get().reducedMotion);
  });
})();

/* =========================
DOWNLOAD THROTTLING
========================= */
const DownloadGuard = (() => {
  let timestamps = [];
  return {
    allow() {
      const now = Date.now();
      timestamps = timestamps.filter(t => now - t < 60000);
      if (timestamps.length >= CONFIG.maxDownloadPerMinute) return false;
      timestamps.push(now);
      return true;
    }
  };
})();

/* =========================
VISIBILITY & CLEANUP
========================= */
document.addEventListener("visibilitychange", () => {
  if (document.hidden) AudioEngine.pause();
});

/* =========================
INSTALL PROMPT HANDLER
========================= */
let deferredPrompt;
window.addEventListener("beforeinstallprompt", e => {
  e.preventDefault();
  deferredPrompt = e;
  const btn = DOM.qs("#install-app");
  if (btn) btn.hidden = false;
});
(() => {
  const btn = DOM.qs("#install-app");
  if (!btn) return;
  btn.addEventListener("click", async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    btn.hidden = true;
  });
})();

/* =========================
INITIAL RENDER
========================= */
document.addEventListener("DOMContentLoaded", () => {
  renderAudio(ContentStore.audio);
  renderBooks(ContentStore.books);
  const year = DOM.qs("#year");
  if (year) year.textContent = new Date().getFullYear();
});
</script>

<!-- =========================
PART 4 END
NEXT PART = SERVICE WORKER INLINE + SEO + FINAL HARDENING
========================= -->
</html>
<!-- =========================
PART 5 ‚Äì FINAL PACK (ULTIMATE HARDENING)
SERVICE WORKER ‚Ä¢ OFFLINE ‚Ä¢ SEO ‚Ä¢ STRUCTURED DATA
PROJECT: Zikr-o-Nazar
========================= -->

<script>
/* =========================
INLINE SERVICE WORKER
========================= */
(function(){
  if(!('serviceWorker' in navigator)) return;

  const swCode = `
    const CACHE_NAME = 'zikr-o-nazar-v1';
    const OFFLINE_URL = '/';
    const CORE_ASSETS = [OFFLINE_URL];

    self.addEventListener('install', e=>{
      e.waitUntil(
        caches.open(CACHE_NAME).then(c=>c.addAll(CORE_ASSETS))
      );
      self.skipWaiting();
    });

    self.addEventListener('activate', e=>{
      e.waitUntil(
        caches.keys().then(keys=>{
          return Promise.all(
            keys.filter(k=>k!==CACHE_NAME).map(k=>caches.delete(k))
          );
        })
      );
      self.clients.claim();
    });

    self.addEventListener('fetch', e=>{
      if(e.request.method!=='GET') return;
      e.respondWith(
        caches.match(e.request).then(r=>{
          return r || fetch(e.request).then(res=>{
            const copy=res.clone();
            caches.open(CACHE_NAME).then(c=>c.put(e.request,copy));
            return res;
          }).catch(()=>caches.match(OFFLINE_URL));
        })
      );
    });
  `;

  const blob = new Blob([swCode],{type:'text/javascript'});
  const url = URL.createObjectURL(blob);
  navigator.serviceWorker.register(url);
})();
</script>

<!-- =========================
SEO META (DYNAMIC SAFE)
========================= -->
<script>
(function(){
  const head=document.head;
  const set=(n,c)=>{
    let m=document.querySelector('meta[name="'+n+'"]');
    if(!m){m=document.createElement('meta');m.name=n;head.appendChild(m);}
    m.content=c;
  };
  set('description','Zikr-o-Nazar Islamic knowledge and media platform');
  set('robots','index, follow');
})();
</script>

<!-- =========================
JSON-LD STRUCTURED DATA
========================= -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebApplication",
  "name":"Zikr-o-Nazar",
  "applicationCategory":"Education",
  "operatingSystem":"All",
  "description":"Islamic digital knowledge and media platform"
}
</script>

<!-- =========================
GLOBAL ERROR BOUNDARY
========================= -->
<script>
window.addEventListener('error',()=>{
  document.body.classList.add('error-safe');
});
window.addEventListener('unhandledrejection',()=>{
  document.body.classList.add('error-safe');
});
</script>

<!-- =========================
FINAL CLEANUP
========================= -->
<script>
window.addEventListener('pagehide',()=>{
  AudioEngine.stop();
});
</script>

</body>
</html>
